---
layout: post
title: 日志ETL
permalink: /:categories/log_etl/
date: 2016-08-04 10:30:15 +0800
category: Develop
tags: [log, etl]
---

### Flume Interceptor

> 标准化目的，开发时"一键执行"不需要熟悉Linux

#### Jar包标准

> 一个jar包，名为sekorm-flume.jar

#### Class标准

> * com.sekorm.flume.interceptor.*
> * 输出有标签时，标签名等于类名

#### Header标签标准

> 只有两类

##### urlType

> 用于区分垃圾和业务

* trash
* business

##### topic

> 用于Kafka加入不同队列,将自己的接在已有的topic后面

* {alreadyTopic}_{myTopic}

#### 设计准则

一、完全解耦

> Interceptor之间没有执行先后要求

二、无对外通信

> 对数据流不能有任何阻碍的可能

#### 已有Interceptor

com.sekorm.flume.interceptor.TrashFilter

> 过滤垃圾

com.sekorm.flume.interceptor.InfoDecode

> 解密加密信息

com.sekorm.flume.interceptor.Persona

> 用户画像

#### 日志标准

每个类会有两个日志

* 一个有INFO以上
* 一个有DEBUG以上

> 将需要的配置（除了名字，位置外）交由运维配置

#### 相关依赖

> 两种方式，放到授权的flume目录下的tmp/lib/下；永久的通过运维放到flume的lib/目录下

#### Dev环境

##### 步骤

> 以secureCRT为例，其他方式前两步会不同，后面一致

**一次性**

1. secureCRT 登录dev环境
2. rz 导入测试新的sekorm-flume.jar, 和 测试用日志文件
3. Flume-loadJar.sh 

**每一次**

4. Flume-loadLog.sh {日志文件名} (每一次）
5. Flume-start.sh
6. 停止运行flume
7. home目录下的log文件夹获得日志

##### 脚本列表

###### Flume-loadLog.sh

> 将要测试的日志导入已经监控的文件夹

```bash
# 例子
Flume-loadLog.sh nginx.log
```

###### Flume-loadJar.sh

> 将sekorm-flume.jar包放入flume的载入目录

```bash
# 例子
Flume-loadJar.sh
```

###### Flume-start.sh

> 启动Flume

```bash
# 例子
Flume-start.sh
```
